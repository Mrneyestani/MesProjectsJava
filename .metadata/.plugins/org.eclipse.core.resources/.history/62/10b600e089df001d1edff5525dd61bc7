package fr.doranco.exemple.model.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.Statement;

import fr.doranco.exemple.entity.CartePaiement;
import fr.doranco.exemple.model.connection.DataBaseConnection;
import fr.doranco.exemple.utils.Dates;

public class CarteDao implements ICartePaiementDao {

	@Override
	public int addCartePaiement(CartePaiement cartePaiement, int userId) throws Exception {
		
		Connection connection = null;
		PreparedStatement ps = null;
		ResultSet rs = null;
		int id = -1;
		try {
			connection = DataBaseConnection.getConnection();
			String requete = "INSERT INTO cartePaiement(numero_carte, date_validite, cryptogramme, user_id) " + "VALUES(?,?,?,?)";
			ps = connection.prepareStatement(requete, Statement.RETURN_GENERATED_KEYS);
			ps.setInt(1, cartePaiement.getNumeroCarte());
			ps.setDate(2, Dates.convertDateUtilToSql(cartePaiement.getDateValidite()));
			ps.setInt(3, cartePaiement.getCryptogramme());
			ps.setInt(4, userId);
			
			ps.executeUpdate();
			rs = ps.getGeneratedKeys();
			if (rs != null && rs.next()) {
				id = rs.getInt(1);
				cartePaiement.setId(id);
			}
		
		} finally {
			if (rs != null && !rs.isClosed()) {
				rs.close();
			}
			if (ps != null && !ps.isClosed()) {
				ps.close();
			}
			if (connection != null && !connection.isClosed()) {
				connection.close();
			}
		}
		return id;
	}

	@Override
	public CartePaiement getCartesPaiement(int Id) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public void removeCartePaiement(int Id) {
		// TODO Auto-generated method stub
		
	}

}
